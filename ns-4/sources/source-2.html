


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > BeneficiaryServiceImpl</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.example.accountsservices.service.impl</a>
</div>

<h1>Coverage Summary for Class: BeneficiaryServiceImpl (com.example.accountsservices.service.impl)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">BeneficiaryServiceImpl</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (18/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    92.7%
  </span>
  <span class="absValue">
    (304/328)
  </span>
</td>
</tr>
  <tr>
    <td class="name">BeneficiaryServiceImpl$$SpringCGLIB$$0</td>
  </tr>
  <tr>
    <td class="name">BeneficiaryServiceImpl$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">BeneficiaryServiceImpl$validateBenType</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (21/21)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    92.8%
  </span>
  <span class="absValue">
    (309/333)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.example.accountsservices.service.impl;
&nbsp;
&nbsp;
&nbsp;import com.example.accountsservices.dto.*;
&nbsp;import com.example.accountsservices.dto.inputDtos.DeleteInputRequestDto;
&nbsp;import com.example.accountsservices.dto.inputDtos.GetInputRequestDto.DIRECTION;
&nbsp;import com.example.accountsservices.dto.inputDtos.GetInputRequestDto;
&nbsp;import com.example.accountsservices.dto.inputDtos.PostInputRequestDto;
&nbsp;import com.example.accountsservices.dto.inputDtos.PutInputRequestDto;
&nbsp;import com.example.accountsservices.dto.outputDtos.OutputDto;
&nbsp;import com.example.accountsservices.exception.AccountsException;
&nbsp;import com.example.accountsservices.exception.BadApiRequestException;
&nbsp;import com.example.accountsservices.exception.BeneficiaryException;
&nbsp;import com.example.accountsservices.model.Accounts;
&nbsp;import com.example.accountsservices.model.Beneficiary;
&nbsp;import com.example.accountsservices.model.Customer;
&nbsp;import com.example.accountsservices.repository.AccountsRepository;
&nbsp;import com.example.accountsservices.repository.BeneficiaryRepository;
&nbsp;import com.example.accountsservices.repository.CustomerRepository;
&nbsp;import com.example.accountsservices.service.AbstractAccountsService;
&nbsp;import com.example.accountsservices.service.IBeneficiaryService;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.springframework.data.domain.Page;
&nbsp;import org.springframework.data.domain.PageRequest;
&nbsp;import org.springframework.data.domain.Pageable;
&nbsp;import org.springframework.data.domain.Sort;
&nbsp;import org.springframework.stereotype.Component;
&nbsp;import org.springframework.stereotype.Service;
&nbsp;
&nbsp;import java.time.LocalDate;
&nbsp;import java.time.Period;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.Optional;
&nbsp;import java.util.Set;
&nbsp;import java.util.regex.Pattern;
&nbsp;
&nbsp;import static com.example.accountsservices.helpers.CodeRetrieverHelper.getBankCode;
&nbsp;import static com.example.accountsservices.helpers.MapperHelper.*;
&nbsp;import static com.example.accountsservices.helpers.PagingHelper.*;
&nbsp;import static com.example.accountsservices.helpers.RegexMatchersHelper.*;
&nbsp;
<b class="fc">&nbsp;@Slf4j</b>
&nbsp;@Service(&quot;beneficiaryServicePrimary&quot;)
&nbsp;public class BeneficiaryServiceImpl extends AbstractAccountsService implements IBeneficiaryService {
&nbsp;    private final BeneficiaryRepository beneficiaryRepository;
&nbsp;    private final AccountsRepository accountsRepository;
<b class="fc">&nbsp;    public enum validateBenType {</b>
<b class="fc">&nbsp;        ADD_BEN, UPDATE_BEN, DELETE_BEN</b>
&nbsp;    }
<b class="fc">&nbsp;    private final validateBenType ADD_BEN = validateBenType.ADD_BEN;</b>
<b class="fc">&nbsp;    private final validateBenType UPDATE_BEN = validateBenType.UPDATE_BEN;</b>
<b class="fc">&nbsp;    private final Beneficiary.RELATION FATHER = Beneficiary.RELATION.FATHER;</b>
<b class="fc">&nbsp;    private final Beneficiary.RELATION MOTHER = Beneficiary.RELATION.MOTHER;</b>
<b class="fc">&nbsp;    private final Beneficiary.RELATION SPOUSE = Beneficiary.RELATION.SPOUSE;</b>
&nbsp;
&nbsp;    BeneficiaryServiceImpl(AccountsRepository accountsRepository,
&nbsp;                           CustomerRepository customerRepository,
&nbsp;                           BeneficiaryRepository beneficiaryRepository) {
<b class="fc">&nbsp;        super(accountsRepository, customerRepository);</b>
<b class="fc">&nbsp;        this.accountsRepository = accountsRepository;</b>
<b class="fc">&nbsp;        this.beneficiaryRepository = beneficiaryRepository;</b>
&nbsp;    }
&nbsp;
&nbsp;    private Beneficiary setBeneficiaryAgeFromDOB(Beneficiary beneficiary) {
<b class="fc">&nbsp;        log.debug(&quot;&lt;-------------------setBeneficiaryAgeFromDOB(Beneficiary) BeneficiaryServiceImpl started ---------------------------------&quot; +</b>
&nbsp;                &quot;------------------------------------------------------------------------------------------------------&gt;&quot;);
&nbsp;        //initialize the age of beneficiaries
<b class="fc">&nbsp;        LocalDate dob = beneficiary.getBenDate_Of_Birth();</b>
<b class="fc">&nbsp;        LocalDate now=LocalDate.now();</b>
<b class="fc">&nbsp;        int age=Period.between(dob,now).getYears();</b>
<b class="fc">&nbsp;        beneficiary.setBenAge(age);</b>
<b class="fc">&nbsp;        log.debug(&quot;&lt;---------------setBeneficiaryAgeFromDOB(Beneficiary) BeneficiaryServiceImpl ended ----------------------------------------&quot; +</b>
&nbsp;                &quot;-------------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        return beneficiary;</b>
&nbsp;    }
&nbsp;
&nbsp;    //For validating Unhappy Paths
&nbsp;    private void validate(Accounts accounts, BeneficiaryDto beneficiaryDto, validateBenType type) throws BeneficiaryException {
<b class="fc">&nbsp;        log.debug(&quot;&lt;----validate(Accounts,BeneficiaryDto, validateBenType) BeneficiaryServiceImpl started -----------------------------------&quot; +</b>
&nbsp;                &quot;------------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        String methodName = &quot;validate(Accounts,validateBenType) in BeneficiaryServiceImpl&quot;;</b>
&nbsp;        String location;
<b class="fc">&nbsp;        switch (type) {</b>
&nbsp;            case ADD_BEN -&gt; {
<b class="fc">&nbsp;                location=&quot;Inside ADD_BEN&quot;;</b>
&nbsp;                boolean notPossible ;
<b class="fc">&nbsp;                List&lt;Beneficiary&gt; listOfBeneficiaries = accounts.getListOfBeneficiary();</b>
<b class="fc">&nbsp;                if (listOfBeneficiaries.size() &gt;= 5) throw new BeneficiaryException(BeneficiaryException.class,</b>
<b class="fc">&nbsp;                        &quot;You can&#39;t add more than 5 beneficiaries&quot;, String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;
&nbsp;                //mandatory fields
<b class="fc">&nbsp;                String email=accounts.getCustomer().getEmail();</b>
<b class="fc">&nbsp;                String adharNumber=accounts.getCustomer().getAdharNumber();</b>
<b class="fc">&nbsp;                String panNumber=accounts.getCustomer().getPanNumber();</b>
<b class="fc">&nbsp;                String phoneNumber=accounts.getCustomer().getPhoneNumber();</b>
&nbsp;
&nbsp;                //not  mandatory  fields
<b class="fc">&nbsp;                String voterId=accounts.getCustomer().getVoterId();</b>
<b class="fc">&nbsp;                String drivingLicense=accounts.getCustomer().getDrivingLicense();</b>
<b class="fc">&nbsp;                String passport=accounts.getCustomer().getPassportNumber();</b>
&nbsp;
&nbsp;
&nbsp;                //new incoming fields
<b class="fc">&nbsp;                String newEmail=beneficiaryDto.getBeneficiaryEmail();</b>
<b class="fc">&nbsp;                String newAdharNumber = beneficiaryDto.getBenAdharNumber();</b>
<b class="fc">&nbsp;                String newPanNumber=beneficiaryDto.getBenPanNumber();</b>
<b class="fc">&nbsp;                String newPhoneNumber=beneficiaryDto.getBenPhoneNumber();</b>
&nbsp;
<b class="fc">&nbsp;                String newVoterId=beneficiaryDto.getBenVoterId();</b>
<b class="fc">&nbsp;                String newDrivingLicense=beneficiaryDto.getBenDrivingLicense();</b>
<b class="fc">&nbsp;                String newPassportNumber=beneficiaryDto.getBenPassportNumber();</b>
&nbsp;
&nbsp;                //you can&#39;t add yourself as your beneficiary  ,
&nbsp;                // check by mandatory as well as optional fields
&nbsp;                // if any matches then either yr info is incorrect or
&nbsp;                //you already have this as beneficiary
<b class="fc">&nbsp;                if (adharNumber.equalsIgnoreCase(newAdharNumber) ||</b>
<b class="fc">&nbsp;                        email.equalsIgnoreCase(newEmail) ||</b>
<b class="fc">&nbsp;                        panNumber.equalsIgnoreCase(newPanNumber) ||</b>
<b class="fc">&nbsp;                        phoneNumber.equalsIgnoreCase(newPhoneNumber) ||</b>
<b class="fc">&nbsp;                 (null!=voterId &amp;&amp; voterId.equalsIgnoreCase(newVoterId))</b>
<b class="fc">&nbsp;                        || (null!=drivingLicense &amp;&amp; drivingLicense.equalsIgnoreCase(newDrivingLicense))</b>
<b class="fc">&nbsp;                        || (null!=passport &amp;&amp; passport.equalsIgnoreCase(newPassportNumber))</b>
&nbsp;                )
<b class="fc">&nbsp;                    throw new BeneficiaryException(BeneficiaryException.class, &quot;You can&#39;t add yourself as beneficiary&quot;,</b>
<b class="fc">&nbsp;                            String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;
&nbsp;
&nbsp;                //check if the same person already exist as a beneficiary
<b class="fc">&nbsp;                notPossible = listOfBeneficiaries.stream().anyMatch(ben -&gt;</b>
<b class="fc">&nbsp;                                ben.getBenAdharNumber().equalsIgnoreCase(newAdharNumber)</b>
<b class="fc">&nbsp;                        || ben.getBeneficiaryEmail().equalsIgnoreCase(newEmail)</b>
<b class="fc">&nbsp;                                        || ben.getBenPanNumber().equalsIgnoreCase(newPanNumber)</b>
<b class="fc">&nbsp;                                || ben.getBenPhoneNumber().equalsIgnoreCase(newPhoneNumber)</b>
<b class="fc">&nbsp;                                        || (null!=newVoterId &amp;&amp; ben.getBenVoterId().equalsIgnoreCase(newVoterId))</b>
<b class="fc">&nbsp;                                        || (null!=newDrivingLicense &amp;&amp; ben.getBenDrivingLicense().equalsIgnoreCase(newDrivingLicense))</b>
<b class="fc">&nbsp;                                        || (null!=newPassportNumber &amp;&amp; ben.getBenPassportNumber().equalsIgnoreCase(newPassportNumber)));</b>
<b class="fc">&nbsp;                if (notPossible) throw new BeneficiaryException(BeneficiaryException.class,</b>
<b class="fc">&nbsp;                        &quot;This person is already added as a beneficiary&quot;,String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;
<b class="fc">&nbsp;                switch (beneficiaryDto.getRelation()) {</b>
&nbsp;                    case FATHER -&gt; {
<b class="fc">&nbsp;                        notPossible = listOfBeneficiaries.stream().anyMatch(ben -&gt; ben.getRelation().equals(FATHER));</b>
<b class="fc">&nbsp;                        if (notPossible) throw new BeneficiaryException(BeneficiaryException.class,</b>
<b class="fc">&nbsp;                                &quot;You already have added one person as a father&quot;, String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                    }
&nbsp;                    case MOTHER -&gt; {
<b class="fc">&nbsp;                        notPossible = listOfBeneficiaries.stream().anyMatch(ben -&gt; ben.getRelation().equals(MOTHER));</b>
<b class="fc">&nbsp;                        if (notPossible) throw new BeneficiaryException(BeneficiaryException.class,</b>
<b class="fc">&nbsp;                                &quot;You already have added one person as a mother&quot;, String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                    }
&nbsp;                    case SPOUSE -&gt; {
<b class="nc">&nbsp;                        notPossible = listOfBeneficiaries.stream().anyMatch(ben -&gt; ben.getRelation().equals(SPOUSE));</b>
<b class="nc">&nbsp;                        if (notPossible) throw new BeneficiaryException(BeneficiaryException.class,</b>
<b class="nc">&nbsp;                                &quot;You already have added one person as a spouse&quot;, String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="fc">&nbsp;            }</b>
&nbsp;            case UPDATE_BEN -&gt; {
<b class="fc">&nbsp;                location=&quot;Inside UPDATE_BEN&quot;;</b>
&nbsp;                boolean isTrue;
<b class="fc">&nbsp;                if (null != beneficiaryDto.getBenDate_Of_Birth()) {</b>
<b class="fc">&nbsp;                    isTrue = Pattern.matches(PATTERN_FOR_DOB, beneficiaryDto.getBenDate_Of_Birth().toString());</b>
<b class="fc">&nbsp;                    if (!isTrue)</b>
<b class="nc">&nbsp;                        throw new BeneficiaryException(BeneficiaryException.class, &quot;Please give DOB in YYYY-mm-dd format&quot;,</b>
<b class="nc">&nbsp;                                String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                }
&nbsp;
<b class="fc">&nbsp;                if (null != beneficiaryDto.getBeneficiaryEmail()) {</b>
<b class="fc">&nbsp;                    isTrue = Pattern.matches(PATTERN_FOR_EMAIL, beneficiaryDto.getBeneficiaryEmail());</b>
<b class="fc">&nbsp;                    if (!isTrue)</b>
<b class="nc">&nbsp;                        throw new BeneficiaryException(BeneficiaryException.class, &quot;Please give email in valid format&quot;,</b>
<b class="nc">&nbsp;                                String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                }
&nbsp;
<b class="fc">&nbsp;                if (null != beneficiaryDto.getBenPhoneNumber()) {</b>
<b class="fc">&nbsp;                    isTrue = Pattern.matches(PATTERN_FOR_PHONE_NUMBER, beneficiaryDto.getBenPhoneNumber());</b>
<b class="fc">&nbsp;                    if (!isTrue)</b>
<b class="nc">&nbsp;                        throw new BeneficiaryException(BeneficiaryException.class, &quot;Please give phone Number in valid format e.g +xx-xxxxxxxxxx&quot;,</b>
<b class="nc">&nbsp;                                String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                }
<b class="fc">&nbsp;                if (null != beneficiaryDto.getBenAdharNumber()) {</b>
<b class="fc">&nbsp;                    isTrue = Pattern.matches(PATTERN_FOR_ADHAR, beneficiaryDto.getBenAdharNumber());</b>
<b class="fc">&nbsp;                    if (!isTrue)</b>
<b class="nc">&nbsp;                        throw new BeneficiaryException(BeneficiaryException.class, &quot;Please give adhar number in valid xxxx-xxxx-xxxx format&quot;,</b>
<b class="nc">&nbsp;                                String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                }
<b class="fc">&nbsp;                if (null != beneficiaryDto.getBenPanNumber()) {</b>
<b class="fc">&nbsp;                    isTrue = Pattern.matches(PATTERN_FOR_PAN_NUMBER, beneficiaryDto.getBenPanNumber());</b>
<b class="fc">&nbsp;                    if (!isTrue)</b>
<b class="nc">&nbsp;                        throw new BeneficiaryException(BeneficiaryException.class, &quot;Please give pan number in valid format&quot;,</b>
<b class="nc">&nbsp;                                String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                }
<b class="fc">&nbsp;                if (null != beneficiaryDto.getBenPassportNumber()) {</b>
<b class="fc">&nbsp;                    isTrue = Pattern.matches(PATTERN_FOR_PASSPORT, beneficiaryDto.getBenPassportNumber());</b>
<b class="fc">&nbsp;                    if (!isTrue)</b>
<b class="nc">&nbsp;                        throw new BeneficiaryException(BeneficiaryException.class, &quot;Please give passport number in valid format&quot;,</b>
<b class="nc">&nbsp;                                String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                }
<b class="fc">&nbsp;                if (null != beneficiaryDto.getBenVoterId()) {</b>
<b class="fc">&nbsp;                    isTrue = Pattern.matches(PATTERN_FOR_VOTER, beneficiaryDto.getBenVoterId());</b>
<b class="fc">&nbsp;                    if (!isTrue)</b>
<b class="nc">&nbsp;                        throw new BeneficiaryException(BeneficiaryException.class, &quot;Please give voter in valid format&quot;,</b>
<b class="nc">&nbsp;                                String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                }
<b class="fc">&nbsp;                if (null != beneficiaryDto.getBenDrivingLicense()) {</b>
<b class="fc">&nbsp;                    isTrue = Pattern.matches(PATTERN_FOR_DRIVING_LICENSE, beneficiaryDto.getBenDrivingLicense());</b>
<b class="fc">&nbsp;                    if (!isTrue)</b>
<b class="nc">&nbsp;                        throw new BeneficiaryException(BeneficiaryException.class, &quot;Please give driving license in valid format&quot;,</b>
<b class="nc">&nbsp;                                String.format(&quot;%s of %s&quot;,location,methodName));</b>
&nbsp;                }
<b class="fc">&nbsp;            }</b>
&nbsp;            case DELETE_BEN -&gt; {
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            default -&gt; throw new BeneficiaryException(BeneficiaryException.class,</b>
&nbsp;                    &quot;Invalid type of request&quot;, methodName);
&nbsp;        }
<b class="fc">&nbsp;        log.debug(&quot;&lt;-------------------validate(Accounts, BeneficiaryDto, validateBenType) BeneficiaryServiceImpl ended ---------------------&quot; +</b>
&nbsp;                &quot;---------------------------------------------------------------------------------------------------&gt;&quot;);
&nbsp;    }
&nbsp;    private Beneficiary addBeneficiary(Accounts fetchedAccount, BeneficiaryDto beneficiaryDto) throws AccountsException, BeneficiaryException {
<b class="fc">&nbsp;        log.debug(&quot;&lt;-----------------addBeneficiary(Accounts,BeneficiaryDto) BeneficiaryServiceImpl started ---------------------------------&quot; +</b>
&nbsp;                &quot;----------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        String methodName=&quot;addBeneficiary(Accounts,BeneficiaryDto) in BeneficiaryServiceImpl&quot;;</b>
&nbsp;
&nbsp;        //validate
<b class="fc">&nbsp;        validate(fetchedAccount, beneficiaryDto, ADD_BEN);</b>
&nbsp;        //Updating the beneficiary info &amp; saving it
<b class="fc">&nbsp;        Beneficiary beneficiaryAccount = mapToBeneficiary(beneficiaryDto);</b>
<b class="fc">&nbsp;        beneficiaryAccount.setBankCode(getBankCode(beneficiaryAccount.getBenBank()));</b>
<b class="fc">&nbsp;        Beneficiary processedBeneficiaryAccount = setBeneficiaryAgeFromDOB(beneficiaryAccount);</b>
&nbsp;        //establishing the beneficiary as child of Account and vice versa
<b class="fc">&nbsp;        List&lt;Beneficiary&gt; beneficiaryList = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        beneficiaryList.add(processedBeneficiaryAccount);</b>
<b class="fc">&nbsp;        fetchedAccount.setListOfBeneficiary(beneficiaryList);</b>
<b class="fc">&nbsp;        processedBeneficiaryAccount.setAccounts(fetchedAccount);</b>
&nbsp;        //sav &amp; return
<b class="fc">&nbsp;        Accounts savedAccounts=accountsRepository.save(fetchedAccount);</b>
<b class="fc">&nbsp;        Optional&lt;Beneficiary&gt; createdBeneficiary=savedAccounts.getListOfBeneficiary().stream().</b>
<b class="fc">&nbsp;                filter(ben-&gt;ben.getBeneficiaryEmail().</b>
<b class="fc">&nbsp;                        equalsIgnoreCase(processedBeneficiaryAccount.getBeneficiaryEmail()))</b>
<b class="fc">&nbsp;                        .findFirst();</b>
<b class="fc">&nbsp;        if(createdBeneficiary.isEmpty()) throw new BeneficiaryException(BeneficiaryException.class,&quot;Faced problem while saving your beneficiary&quot;,methodName);</b>
<b class="fc">&nbsp;        log.debug(&quot;&lt;-------------addBeneficiary(Accounts,BeneficiaryDto) BeneficiaryServiceImpl ended ----------------------------------------&quot; +</b>
&nbsp;                &quot;-------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        return createdBeneficiary.get();</b>
&nbsp;    }
&nbsp;
&nbsp;    private Optional&lt;Beneficiary&gt; getBeneficiaryById(Accounts fetchedAccount, Long benId) throws BeneficiaryException {
<b class="fc">&nbsp;        log.debug(&quot;&lt;-----------------getBeneficiaryById(Accounts, Long ) BeneficiaryServiceImpl started ----------------------------------&quot; +</b>
&nbsp;                &quot;----------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        String methodName = &quot;getBeneficiaryById(Accounts,Long&quot;;</b>
<b class="fc">&nbsp;        if (fetchedAccount.getListOfBeneficiary().size() == 0)</b>
<b class="fc">&nbsp;            throw new BeneficiaryException(BeneficiaryException.class,</b>
&nbsp;                    &quot;No beneficiaries found for this account&quot;, methodName);
<b class="fc">&nbsp;        log.debug(&quot;&lt;-------------------------getBeneficiaryById(Accounts, Long) BeneficiaryServiceImpl ended --------------------------------&quot; +</b>
&nbsp;                &quot;---------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        return fetchedAccount.getListOfBeneficiary().stream().</b>
<b class="fc">&nbsp;                filter(ben -&gt; ben.getBeneficiaryId().equals(benId)).findFirst();</b>
&nbsp;    }
&nbsp;
&nbsp;    private PageableResponseDto&lt;BeneficiaryDto&gt; getAllBeneficiariesOfAnAccountByAccountNumber(Accounts fetchedAccount,Pageable pageable) throws AccountsException, BeneficiaryException {
<b class="fc">&nbsp;        log.debug(&quot;&lt;------------- getAllBeneficiariesOfAnAccountByAccountNumber(Accounts,Pageable) BeneficiaryServiceImpl started -------------&quot; +</b>
&nbsp;                &quot;---------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        String methodName = &quot;getAllAccountsByCustomerId(Account,Pageable) in BeneficiaryServiceImpl&quot;;</b>
<b class="fc">&nbsp;        Optional&lt;Page&lt;Beneficiary&gt;&gt; allPagedBeneficiary = beneficiaryRepository.findAllByAccounts_AccountNumber(fetchedAccount.getAccountNumber(), pageable);</b>
<b class="fc">&nbsp;        if (allPagedBeneficiary.isEmpty())</b>
<b class="fc">&nbsp;            throw new BeneficiaryException(BeneficiaryException.class,</b>
<b class="fc">&nbsp;                    String.format(&quot;No such beneficiary present for this account ben id: %s&quot;, fetchedAccount.getAccountNumber()), methodName);</b>
<b class="fc">&nbsp;        log.debug(&quot;&lt;---------getAllBeneficiariesOfAnAccountByAccountNumber(Accounts fetchedAccount,Pageable pageable) BeneficiaryServiceImpl ended --------------------------------------&quot; +</b>
&nbsp;                &quot;-----------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        return getPageableResponse(allPagedBeneficiary.get(), BeneficiaryDto.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    private Beneficiary processedBeneficiaryAccount(Beneficiary oldBeneficiaryData, Beneficiary newBeneficiaryData) throws AccountsException {
<b class="fc">&nbsp;        log.debug(&quot;&lt;--------------processedBeneficiaryAccount(Beneficiary, Beneficiary) BeneficiaryServiceImpl started ----------------------------&quot; +</b>
&nbsp;                &quot;--------------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        String newBeneficiaryName = newBeneficiaryData.getBeneficiaryName();</b>
<b class="fc">&nbsp;        Long newBeneficiaryNumber = newBeneficiaryData.getBeneficiaryAccountNumber();</b>
<b class="fc">&nbsp;        LocalDate newBeneficiaryDOB = newBeneficiaryData.getBenDate_Of_Birth();</b>
<b class="fc">&nbsp;        String newBeneficiaryAdharNumber = newBeneficiaryData.getBenAdharNumber();</b>
<b class="fc">&nbsp;        Beneficiary.RELATION newBeneficaryRelation = newBeneficiaryData.getRelation();</b>
<b class="fc">&nbsp;        String newBeneficiaryPanNumber = newBeneficiaryData.getBenPanNumber();</b>
<b class="fc">&nbsp;        String newBeneficiaryPassport = newBeneficiaryData.getBenPassportNumber();</b>
<b class="fc">&nbsp;        String newBeneficiaryVoterId = newBeneficiaryData.getBenVoterId();</b>
<b class="fc">&nbsp;        Beneficiary.BanksSupported newBenBank=newBeneficiaryData.getBenBank();</b>
<b class="fc">&nbsp;        String newBeneficiaryPhoneNumber=newBeneficiaryData.getBenPhoneNumber();</b>
<b class="fc">&nbsp;        String newBeneficiaryEmail=newBeneficiaryData.getBeneficiaryEmail();</b>
<b class="fc">&nbsp;        String newBenDrivingLicense=newBeneficiaryData.getBenDrivingLicense();</b>
&nbsp;
<b class="fc">&nbsp;        String oldBeneficiaryName = oldBeneficiaryData.getBeneficiaryName();</b>
<b class="fc">&nbsp;        Long oldBeneficiaryNumber = oldBeneficiaryData.getBeneficiaryAccountNumber();</b>
<b class="fc">&nbsp;        LocalDate oldBeneficiaryDOB = oldBeneficiaryData.getBenDate_Of_Birth();</b>
<b class="fc">&nbsp;        String oldBeneficiaryAdharNumber = oldBeneficiaryData.getBenAdharNumber();</b>
<b class="fc">&nbsp;        Beneficiary.RELATION oldBeneficiaryRelation = oldBeneficiaryData.getRelation();</b>
<b class="fc">&nbsp;        String oldBeneficiaryPanNumber = oldBeneficiaryData.getBenPanNumber();</b>
<b class="fc">&nbsp;        String oldBeneficiaryPassport = oldBeneficiaryData.getBenPassportNumber();</b>
<b class="fc">&nbsp;        String oldBeneficiaryVoterId = oldBeneficiaryData.getBenVoterId();</b>
<b class="fc">&nbsp;        Beneficiary.BanksSupported oldBenBank=oldBeneficiaryData.getBenBank();</b>
<b class="fc">&nbsp;        String oldBeneficiaryPhoneNumber=oldBeneficiaryData.getBenPhoneNumber();</b>
<b class="fc">&nbsp;        String oldBeneficiaryEmail=oldBeneficiaryData.getBeneficiaryEmail();</b>
<b class="fc">&nbsp;        String oldDrivingLicense=oldBeneficiaryData.getBenDrivingLicense();</b>
&nbsp;
<b class="fc">&nbsp;        if (null != newBeneficiaryName &amp;&amp; !newBeneficiaryName.equalsIgnoreCase(oldBeneficiaryName))</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBeneficiaryName(newBeneficiaryName);</b>
&nbsp;
<b class="fc">&nbsp;        if (null != newBeneficiaryNumber &amp;&amp; !newBeneficiaryNumber.equals(oldBeneficiaryNumber))</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBeneficiaryAccountNumber(newBeneficiaryNumber);</b>
&nbsp;
<b class="fc">&nbsp;        if (null != newBeneficiaryDOB &amp;&amp; !newBeneficiaryDOB.equals(oldBeneficiaryDOB)) {</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBenDate_Of_Birth(newBeneficiaryDOB);</b>
&nbsp;
&nbsp;            //calculating &amp; setting the new age
<b class="fc">&nbsp;            LocalDate now=LocalDate.now();</b>
<b class="fc">&nbsp;            int age= Period.between(newBeneficiaryDOB,now).getYears();</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBenAge(age);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (null != newBeneficiaryAdharNumber &amp;&amp; !newBeneficiaryAdharNumber.equalsIgnoreCase(oldBeneficiaryAdharNumber))</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBenAdharNumber(newBeneficiaryAdharNumber);</b>
&nbsp;
<b class="fc">&nbsp;        if (null != newBeneficaryRelation &amp;&amp; !newBeneficaryRelation.equals(oldBeneficiaryRelation))</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setRelation(newBeneficaryRelation);</b>
&nbsp;
<b class="fc">&nbsp;        if (null != newBeneficiaryPanNumber &amp;&amp; !newBeneficiaryPanNumber.equalsIgnoreCase(oldBeneficiaryPanNumber))</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBenPanNumber(newBeneficiaryPanNumber);</b>
&nbsp;
<b class="fc">&nbsp;        if (null != newBeneficiaryPassport &amp;&amp; !newBeneficiaryPassport.equalsIgnoreCase(oldBeneficiaryPassport))</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBenPassportNumber(newBeneficiaryPassport);</b>
&nbsp;
<b class="fc">&nbsp;        if (null != newBeneficiaryVoterId &amp;&amp; !newBeneficiaryVoterId.equalsIgnoreCase(oldBeneficiaryVoterId))</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBenVoterId(newBeneficiaryVoterId);</b>
&nbsp;
<b class="fc">&nbsp;        if(null!=newBeneficiaryPhoneNumber &amp;&amp; !newBeneficiaryPhoneNumber.equalsIgnoreCase(oldBeneficiaryPhoneNumber))</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBenPhoneNumber(newBeneficiaryPhoneNumber);</b>
&nbsp;
<b class="fc">&nbsp;        if(null!=newBeneficiaryEmail &amp;&amp; !newBeneficiaryEmail.equalsIgnoreCase(oldBeneficiaryEmail))</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBeneficiaryEmail(newBeneficiaryEmail);</b>
&nbsp;
<b class="fc">&nbsp;        if(null!=newBenBank &amp;&amp; !newBenBank.equals(oldBenBank))</b>
&nbsp;        {
<b class="fc">&nbsp;            oldBeneficiaryData.setBenBank(newBenBank);</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBankCode(getBankCode(newBenBank));</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if(null!=newBenDrivingLicense &amp;&amp; !newBenDrivingLicense.equalsIgnoreCase(oldDrivingLicense)){</b>
<b class="fc">&nbsp;            oldBeneficiaryData.setBenDrivingLicense(newBenDrivingLicense);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        log.debug(&quot;&lt;----------processedBeneficiaryAccount(Beneficiary, Beneficiary) BeneficiaryServiceImpl ended -----------------------------&quot; +</b>
&nbsp;                &quot;----------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        return oldBeneficiaryData;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param fetchedAccounts
&nbsp;     * @param beneficiaryDto
&nbsp;     * @return
&nbsp;     */
&nbsp;    private Beneficiary updateBeneficiaryDetailsOfAnAccount(Accounts fetchedAccounts, BeneficiaryDto beneficiaryDto) throws AccountsException, BeneficiaryException {
<b class="fc">&nbsp;        log.debug(&quot;&lt;---------------updateBeneficiaryDetailsOfAnAccount(Accounts, BeneficiaryDto) BeneficiaryServiceImpl started -----------------&quot; +</b>
&nbsp;                &quot;---------------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        String methodName = &quot;updateBeneficiaryDetailsOfAnAccount(Long , BeneficiaryDto ) in BeneficiaryServiceImpl&quot;;</b>
&nbsp;
&nbsp;        //validate
<b class="fc">&nbsp;        validate(fetchedAccounts, beneficiaryDto, UPDATE_BEN);</b>
&nbsp;
&nbsp;        //fetch the beneficiary from beneficiaryList
<b class="fc">&nbsp;        Long BENEFICIARY_ID = beneficiaryDto.getBeneficiaryId();</b>
<b class="fc">&nbsp;        if (null == BENEFICIARY_ID) throw new BeneficiaryException(BeneficiaryException.class,</b>
&nbsp;                &quot;Please enter a valid beneficiary id&quot;, methodName);
<b class="fc">&nbsp;        Optional&lt;Beneficiary&gt; beneficiaryAccount = fetchedAccounts.getListOfBeneficiary().stream().</b>
<b class="fc">&nbsp;                filter(beneficiary -&gt; BENEFICIARY_ID.equals(beneficiary.getBeneficiaryId())).</b>
<b class="fc">&nbsp;                findFirst();</b>
<b class="fc">&nbsp;        if (beneficiaryAccount.isEmpty())</b>
<b class="fc">&nbsp;            throw new BeneficiaryException(BeneficiaryException.class,</b>
<b class="fc">&nbsp;                    String.format(&quot;No such beneficiary accounts exist with beneficiary id %s&quot;,</b>
&nbsp;                            BENEFICIARY_ID), methodName);
&nbsp;
&nbsp;        //update
<b class="fc">&nbsp;        Beneficiary newBeneficiaryData = mapToBeneficiary(beneficiaryDto);</b>
<b class="fc">&nbsp;        Beneficiary processedAccount = processedBeneficiaryAccount(beneficiaryAccount.get(), newBeneficiaryData);</b>
<b class="fc">&nbsp;        log.debug(&quot;&lt;---------------updateBeneficiaryDetailsOfAnAccount(Accounts, BeneficiaryDto) BeneficiaryServiceImpl ended ----------------&quot; +</b>
&nbsp;                &quot;------------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        return beneficiaryRepository.save(processedAccount);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void deleteBeneficiariesForAnAccount(Accounts fetchedAccounts, Long beneficiaryId) throws AccountsException, BeneficiaryException {
<b class="fc">&nbsp;        log.debug(&quot;&lt;---------------deleteBeneficiariesForAnAccount(Accounts, Long) BeneficiaryServiceImpl started ----------------------&quot; +</b>
&nbsp;                &quot;------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        String methodName = &quot; deleteBeneficiariesForAnAccount(Long , Long )  in BeneficiaryServiceImpl&quot;;</b>
<b class="fc">&nbsp;        if (null == beneficiaryId)</b>
<b class="fc">&nbsp;            throw new BeneficiaryException(BeneficiaryException.class, &quot;Please provide a valid beneficiary id&quot;, methodName);</b>
&nbsp;
&nbsp;        //filter out the beneficiary list of that account
<b class="fc">&nbsp;        List&lt;Beneficiary&gt; filteredListOfBeneficiaries = fetchedAccounts.getListOfBeneficiary().</b>
<b class="fc">&nbsp;                stream().</b>
<b class="fc">&nbsp;                filter(beneficiary -&gt; !beneficiaryId.equals(beneficiary.getBeneficiaryId())).</b>
<b class="fc">&nbsp;                toList();</b>
&nbsp;        //set the final filtered resultant list to that account
<b class="fc">&nbsp;        fetchedAccounts.setListOfBeneficiary(filteredListOfBeneficiaries);</b>
&nbsp;        //delete that beneficiary
<b class="fc">&nbsp;        beneficiaryRepository.deleteByBeneficiaryId(beneficiaryId);</b>
<b class="fc">&nbsp;        log.debug(&quot;&lt;-------------deleteBeneficiariesForAnAccount(Accounts, Long ) BeneficiaryServiceImpl ended ------------------------&quot; +</b>
&nbsp;                &quot;------------------------------------------------------------------------------------------------&gt;&quot;);
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private void deleteAllBeneficiaries(Accounts fetchedAccounts) throws AccountsException {
<b class="fc">&nbsp;        log.debug(&quot;&lt;------------deleteAllBeneficiaries(Accounts) BeneficiaryServiceImpl started ----------------------------------------&quot; +</b>
&nbsp;                &quot;-----------------------------------------------------------------------------------------------&gt;&quot;);
&nbsp;        //delete everyone
<b class="fc">&nbsp;        beneficiaryRepository.deleteAllByAccounts_AccountNumber(fetchedAccounts.getAccountNumber());</b>
<b class="fc">&nbsp;        log.debug(&quot;&lt;------------deleteAllBeneficiaries(Accounts ) BeneficiaryServiceImpl ended ------------------------------------------&quot; +</b>
&nbsp;                &quot;------------------------------------------------------------------------------------------------&gt;&quot;);
&nbsp;    }
&nbsp;
&nbsp;    private PageableResponseDto&lt;BeneficiaryDto&gt; beneficiaryPagination(DIRECTION sortDir,String sortBy,int pageNumber,int pageSize,Accounts fetchedAccount) throws BadApiRequestException, BeneficiaryException, AccountsException {
<b class="fc">&nbsp;        log.debug(&quot;&lt;------------beneficiaryPagination(DIRECTION,String,int ,int ,Accounts ) BeneficiaryServiceImpl started -----------------------------------&quot; +</b>
&nbsp;                &quot;-----------------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        String methodName=&quot;beneficiaryPagination(DIRECTION,String,int,int,Accounts) in AccountsServiceImpl&quot;;</b>
<b class="fc">&nbsp;        Sort sort = sortDir.equals(PAGE_SORT_DIRECTION_ASCENDING) ? Sort.by(sortBy).ascending() : Sort.by(sortBy).descending();</b>
<b class="fc">&nbsp;        Pageable pageable = PageRequest.of(pageNumber, pageSize, sort);</b>
<b class="fc">&nbsp;        PageableResponseDto&lt;BeneficiaryDto&gt; pageableResponseDto = getAllBeneficiariesOfAnAccountByAccountNumber(fetchedAccount,pageable);</b>
&nbsp;
<b class="fc">&nbsp;        if (pageableResponseDto.getContent().size() == 0)</b>
<b class="nc">&nbsp;            throw new BadApiRequestException(BadApiRequestException.class,</b>
<b class="nc">&nbsp;                    String.format(&quot;Account with id %s have no beneficiary present&quot;, fetchedAccount.getAccountNumber()),</b>
&nbsp;                    methodName);
&nbsp;
<b class="fc">&nbsp;        log.debug(&quot;&lt;-------------beneficiaryPagination(DIRECTION,String,int,int ,Accounts ) BeneficiaryServiceImpl ended --------------------------------------&quot; +</b>
&nbsp;                &quot;-----------------------------------------------------------------------------------------------------------&gt;&quot;);
<b class="fc">&nbsp;        return  pageableResponseDto;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public OutputDto postRequestBenExecutor(PostInputRequestDto postInputDto) throws BeneficiaryException, AccountsException {
<b class="fc">&nbsp;        String methodName = &quot;postRequestBenExecutor(InputDto) in BeneficiaryServiceImpl&quot;;</b>
<b class="fc">&nbsp;        BeneficiaryDto beneficiaryDto = mapInputDtoToBenDto(postInputDto);</b>
&nbsp;
&nbsp;        //get the account
<b class="fc">&nbsp;        Long accountNUmber = postInputDto.getAccountNumber();</b>
<b class="fc">&nbsp;        Accounts fetchedAccount = fetchAccountByAccountNumber(accountNUmber);</b>
<b class="fc">&nbsp;        AccountsDto accountsDto = mapToAccountsDto(fetchedAccount);</b>
&nbsp;
&nbsp;        //get the customer
<b class="fc">&nbsp;        Customer customer = fetchedAccount.getCustomer();</b>
<b class="fc">&nbsp;        CustomerDto customerDto = mapToCustomerDto(customer);</b>
&nbsp;
<b class="fc">&nbsp;        BeneficiaryDto.BenUpdateRequest requestType = postInputDto.getBenRequest();</b>
<b class="fc">&nbsp;        if (null == requestType) throw new BeneficiaryException(BeneficiaryException.class,</b>
&nbsp;                &quot;Please provide a non null request-type&quot;, methodName);
<b class="fc">&nbsp;        switch (requestType) {</b>
&nbsp;            case ADD_BEN -&gt; {
<b class="fc">&nbsp;                Beneficiary beneficiary = addBeneficiary(fetchedAccount, beneficiaryDto);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;                return OutputDto.builder()</b>
<b class="fc">&nbsp;                        .customer(mapToCustomerOutputDto(customerDto))</b>
<b class="fc">&nbsp;                        .accounts(mapToAccountsOutputDto(accountsDto))</b>
<b class="fc">&nbsp;                        .beneficiary(mapToBeneficiaryDto(beneficiary))</b>
<b class="fc">&nbsp;                        .defaultMessage(String.format(&quot;Beneficiary with id:%s has been added for account with id:%s&quot;,</b>
<b class="fc">&nbsp;                                beneficiary.getBeneficiaryId(),fetchedAccount.getAccountNumber())).build();</b>
&nbsp;            }
<b class="fc">&nbsp;            default -&gt; throw new BeneficiaryException(BeneficiaryException.class, &quot;Wrong request type&quot;, methodName);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public OutputDto putRequestBenExecutor(PutInputRequestDto putInputRequestDto) throws BeneficiaryException, AccountsException {
<b class="fc">&nbsp;        String methodName = &quot;putRequestBenExecutor(InputDto) in BeneficiaryServiceImpl&quot;;</b>
<b class="fc">&nbsp;        BeneficiaryDto beneficiaryDto = mapPutInputRequestDtoToBenDto(putInputRequestDto);</b>
&nbsp;
&nbsp;        //get the account
<b class="fc">&nbsp;        Long accountNumber = putInputRequestDto.getAccountNumber();</b>
<b class="fc">&nbsp;        Accounts fetchedAccount = fetchAccountByAccountNumber(accountNumber);</b>
&nbsp;
&nbsp;        //get customer
<b class="fc">&nbsp;        Customer loadCustomer = fetchedAccount.getCustomer();</b>
&nbsp;
<b class="fc">&nbsp;        BeneficiaryDto.BenUpdateRequest requestType = putInputRequestDto.getBenRequest();</b>
<b class="fc">&nbsp;        if (null == requestType) throw new BeneficiaryException(BeneficiaryException.class,</b>
&nbsp;                &quot;Please provide a non null request-type&quot;, methodName);
<b class="fc">&nbsp;        switch (requestType) {</b>
&nbsp;            case UPDATE_BEN -&gt; {
<b class="fc">&nbsp;                Beneficiary loadedBeneficiary = updateBeneficiaryDetailsOfAnAccount(fetchedAccount, beneficiaryDto);</b>
&nbsp;
<b class="fc">&nbsp;                return OutputDto.builder()</b>
<b class="fc">&nbsp;                        .customer(mapToCustomerOutputDto(mapToCustomerDto(loadCustomer)))</b>
<b class="fc">&nbsp;                        .accounts(mapToAccountsOutputDto(mapToAccountsDto(fetchedAccount)))</b>
<b class="fc">&nbsp;                        .beneficiary(mapToBeneficiaryDto(loadedBeneficiary))</b>
<b class="fc">&nbsp;                        .defaultMessage(String.format(&quot;beneficiaryId:%s beneficiary account has been updated&quot;,loadedBeneficiary.getBeneficiaryId()))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
<b class="fc">&nbsp;            default -&gt; throw new BeneficiaryException(BeneficiaryException.class,</b>
&nbsp;                    &quot;Wrong request type&quot;, methodName);
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public OutputDto getRequestBenExecutor(GetInputRequestDto getInputRequestDto) throws AccountsException, BeneficiaryException, BadApiRequestException {
<b class="fc">&nbsp;        String methodName = &quot;getRequestBenExecutor(InputDto) in BeneficiaryServiceImpl&quot;;</b>
<b class="fc">&nbsp;        BeneficiaryDto beneficiaryDto = mapGetRequestInputDtoToBenDto(getInputRequestDto);</b>
&nbsp;
&nbsp;        //get paging details
<b class="fc">&nbsp;        int pageNumber = getInputRequestDto.getPageNumber();</b>
<b class="fc">&nbsp;        if (pageNumber &lt; 0) throw new BadApiRequestException(BadApiRequestException.class,</b>
&nbsp;                &quot;pageNumber cant be in negative&quot;, methodName);
&nbsp;
<b class="fc">&nbsp;        int pageSize = getInputRequestDto.getPageSize();</b>
<b class="fc">&nbsp;        if (pageSize &lt; 0)</b>
<b class="nc">&nbsp;            throw new BadApiRequestException(BadApiRequestException.class, &quot;Page Size can&#39;t be in negative&quot;, methodName);</b>
<b class="fc">&nbsp;        pageSize = (getInputRequestDto.getPageSize() == 0) ? DEFAULT_PAGE_SIZE : getInputRequestDto.getPageSize();</b>
&nbsp;
<b class="fc">&nbsp;        String sortBy = (null == getInputRequestDto.getSortBy()) ? &quot;beneficiaryName&quot; : getInputRequestDto.getSortBy();</b>
<b class="fc">&nbsp;        DIRECTION sortDir = (null == getInputRequestDto.getSortDir()) ? DIRECTION.asc : getInputRequestDto.getSortDir();</b>
&nbsp;
&nbsp;
&nbsp;        //get the account
<b class="fc">&nbsp;        Long accountNumber = getInputRequestDto.getAccountNumber();</b>
<b class="fc">&nbsp;        Accounts fetchedAccount = fetchAccountByAccountNumber(accountNumber);</b>
&nbsp;
<b class="fc">&nbsp;        BeneficiaryDto.BenUpdateRequest requestType = getInputRequestDto.getBenRequest();</b>
<b class="fc">&nbsp;        if (null == requestType) throw new BeneficiaryException(BeneficiaryException.class,</b>
&nbsp;                &quot;Please provide a non null request-type&quot;, methodName);
&nbsp;
&nbsp;        String location;
<b class="fc">&nbsp;        switch (requestType) {</b>
&nbsp;            case GET_BEN -&gt; {
<b class="fc">&nbsp;                location = &quot;Inside GET_BEN&quot;;</b>
<b class="fc">&nbsp;                Optional&lt;Beneficiary&gt; beneficiary = getBeneficiaryById(fetchedAccount, beneficiaryDto.getBeneficiaryId());</b>
<b class="fc">&nbsp;                if (beneficiary.isEmpty())</b>
<b class="fc">&nbsp;                    throw new BeneficiaryException(BeneficiaryException.class, String.format(&quot;No such beneficiaries present with id:%s&quot;,</b>
<b class="fc">&nbsp;                            beneficiaryDto.getBeneficiaryId()), String.format(&quot;%s of %s&quot;, location, methodName));</b>
&nbsp;
<b class="fc">&nbsp;                return OutputDto.builder()</b>
<b class="fc">&nbsp;                        .customer(mapToCustomerOutputDto(mapToCustomerDto(fetchedAccount.getCustomer())))</b>
<b class="fc">&nbsp;                        .accounts(mapToAccountsOutputDto(mapToAccountsDto(fetchedAccount)))</b>
<b class="fc">&nbsp;                        .beneficiary(mapToBeneficiaryDto(beneficiary.get()))</b>
<b class="fc">&nbsp;                        .defaultMessage(String.format(&quot;Fetched beneficiary with id:%s&quot;,beneficiaryDto.getBeneficiaryId()))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
&nbsp;            case GET_ALL_BEN -&gt; {
<b class="fc">&nbsp;                location = &quot;Inside GET_ALL_BEN&quot;;</b>
&nbsp;                //validate the genuineness of sorting fields
<b class="fc">&nbsp;                Set&lt;String&gt; allPageableFieldsOfAccounts = getAllPageableFieldsOfBeneficiary();</b>
<b class="fc">&nbsp;                if (!allPageableFieldsOfAccounts.contains(sortBy))</b>
<b class="fc">&nbsp;                    throw new BadApiRequestException(BadApiRequestException.class,</b>
<b class="fc">&nbsp;                            String.format(&quot;%s is not a valid field of account&quot;, sortBy), String.format(&quot;Inside %s of %s&quot;, location, methodName));</b>
&nbsp;                //paging &amp; sorting
<b class="fc">&nbsp;                PageableResponseDto&lt;BeneficiaryDto&gt; pageableResponseDto=beneficiaryPagination(sortDir,sortBy,pageNumber,pageSize,fetchedAccount);</b>
&nbsp;
&nbsp;
<b class="fc">&nbsp;                return OutputDto.builder()</b>
<b class="fc">&nbsp;                        .customer(mapToCustomerOutputDto(mapToCustomerDto(fetchedAccount.getCustomer())))</b>
<b class="fc">&nbsp;                        .accounts(mapToAccountsOutputDto(mapToAccountsDto(fetchedAccount)))</b>
<b class="fc">&nbsp;                        .beneficiaryListPages(pageableResponseDto)</b>
<b class="fc">&nbsp;                        .defaultMessage(String.format(&quot;Fetched all beneficiaries of account:%s&quot;,fetchedAccount.getAccountNumber()))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
<b class="fc">&nbsp;            default -&gt; throw new BeneficiaryException(BeneficiaryException.class,</b>
&nbsp;                    &quot;Wrong request type&quot;, methodName);
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public OutputDto deleteRequestBenExecutor(DeleteInputRequestDto deleteInputRequestDto) throws BeneficiaryException, AccountsException {
<b class="fc">&nbsp;        String methodName = &quot;deleteRequestBenExecutor(InputDto) in BeneficiaryServiceImpl&quot;;</b>
<b class="fc">&nbsp;        BeneficiaryDto beneficiaryDto = mapDeleteInputRequestDtoToBenDto(deleteInputRequestDto);</b>
&nbsp;
&nbsp;        //get the account
<b class="fc">&nbsp;        Long accountNUmber = deleteInputRequestDto.getAccountNumber();</b>
<b class="fc">&nbsp;        Accounts fetchedAccount = fetchAccountByAccountNumber(accountNUmber);</b>
&nbsp;
<b class="fc">&nbsp;        BeneficiaryDto.BenUpdateRequest requestType = deleteInputRequestDto.getBenRequest();</b>
<b class="fc">&nbsp;        if (null == requestType) throw new BeneficiaryException(BeneficiaryException.class,</b>
&nbsp;                &quot;Please provide a non null request-type&quot;, methodName);
<b class="fc">&nbsp;        switch (requestType) {</b>
&nbsp;            case DELETE_BEN -&gt; {
<b class="fc">&nbsp;                deleteBeneficiariesForAnAccount(fetchedAccount, beneficiaryDto.getBeneficiaryId());</b>
<b class="fc">&nbsp;                return OutputDto.builder()</b>
<b class="fc">&nbsp;                        .defaultMessage(String.format(&quot;Beneficiary with id:%s has been deleted&quot;,beneficiaryDto.getBeneficiaryId()))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
&nbsp;            case DELETE_ALL_BEN -&gt; {
<b class="fc">&nbsp;                deleteAllBeneficiaries(fetchedAccount);</b>
<b class="fc">&nbsp;                return OutputDto.builder()</b>
<b class="fc">&nbsp;                        .defaultMessage(String.format(&quot;All beneficiaries with id:%s have been deleted&quot;,fetchedAccount.getAccountNumber()))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
<b class="fc">&nbsp;            default -&gt; throw new BeneficiaryException(BeneficiaryException.class, &quot;Wrong request type&quot;, methodName);</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-06-25 22:52</div>
</div>
</body>
</html>
